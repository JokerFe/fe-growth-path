## 浏览器的EventLoop

### 浏览器线程

我们都知道Javascript是单线程的，但是浏览器不是。这里的单线程是指：浏览器中用来解释执行JavaScript代码的只有一个线程，也就是JS引擎线程。那么浏览器有哪些线程呢？

1. **GUI渲染线程**：负责浏览器的界面渲染，包括解析HTML、CSS，构建DOM树、Render树、布局和绘制等工作。当页面发生重绘、重排(回流)时，也是该线程执行。
2. **JS引擎线程**：负责处理、解析和执行JavaScript脚本程序，如V8引擎。该线程与GUI渲染线程是互斥的，优先级高于GUI渲染线程。JS执行时间过长，就会造成页面渲染的不流畅、导致页面渲染加载阻塞。
3. **事件触发线程**：用来控制事件循环的调度器，当有异步任务时：setTimeout、点击事件、Ajax请求等，它会将这些任务交给对应的线程去处理，处理完成后再由它将事件添加到任务队列的队尾，等待JS引擎的处理。
4. **异步HTTP请求线程**：在XMLHttpRequest在连接后通过浏览器新开一个线程请求
5. **定时处理线程**：setInterval与setTimeout所在的线程。定时计数器是在该线程进行计时并触发。

### EventLoop

浏览器通过**事件触发线程**来控制**事件循环机制**和**异步事件队列**(即消息队列)。JS引擎执行JavaScript代码时，遇到异步任务就会通过事件触发线程交给相应的线程单独去执行该任务，执行完成后由事件触发线程将异步任务对应的回调函数加入到异步事件队列中。

JS引擎会维护一个同步执行栈，同步代码会依次加入执行栈进行执行，执行结束后出栈。这一块涉及到**JavaScript的执行堆栈**的内容。如果执行栈中的任务执行完成，即同步执行栈空闲，事件触发线程就会从异步事件队列中取出最先加入的异步回调函数进行执行，提取规则是**先入先出FIFO**规则，异步实践队列类似队列的数据结构。

#### 微任务宏任务

所有任务又分为微任务micro和宏任务macro。

**宏任务**包含：主代码块、setTimeout、setInterval、ajax、UI Render、setImmediate(node)

**微任务**包含：Promise、Object.observe、MutationObserver、process.nextTick(node)

**宏任务是js引擎进行处理的，微任务是浏览器的行为。微任务必然是由宏任务执行是创建的。**

## Nodejs的EventLoop

