# 单元测试如何测试？代码覆盖率如何？

## 一、为什么要单元测试？

有单元测试加持可以保障交付代码质量，增强自己和他人的信心。我们选择第三方库的时候不也是会优先选择有测试保障的吗？未来对代码进行改动时也可以节省回归测试的时间。

## 二、怎么测？

在做单元测试时尽量以集成测试为主，对少量难以被集成测试覆盖或需要分发的代码做单元测试，同时也可以有少量的端到端测试辅助。
尽量不测试代码实现，测试代码实现可能会让测试用例很快就失效。比如断言变量，当变量名发生变更时会导致测试不通过，但是可能功能并没有发生改变。

#### 要写些什么样的测试？

以用户视角测试程序的功能，而非上帝视角。
对一个组件，传入不同参数渲染 dom，对用户而言可能可以看到某些特定文字或可以做某些操作。此时可以断言 dom 是否出现了某些字，做动作（如点击、输入、提交表单等）是否有正确的响应。

#### 不要写什么样的测试？

不要测试实现细节。比如以上帝视角检查 redux store 上的数据、state 的数据等，而这些在最终用户眼里是不存在的，用户能感知的只是所表现的功能。

## 三、测试框架和周边配套

Jest 是 facebook 出品的测试框架。开箱即用，自带断言库、`mock`、覆盖率报告等功能。
由于前端要测试 Ul，需要在模拟浏览器环境中渲染出 dom，所以需要一个这样的库。存在很多这样的库，常用的有 `Bnzyme`、`etesting-library/react`。

## 四、测试覆盖/效率报告

Jest 自带测试报告，但是众多的项目分散在 gitlab 中给查看报告带来了麻烦。需要考虑有一个集中的地方查看测试报告。这里结合了` sonar `和 `reportportal `归集测试报告，可以通过一个集中的地方查看所有项目的测试报告。
其中结合 `sonar `的代码扫描功能可以查看测试覆盖率等报告信息。`reportportal` 可以查看测试执行率，另外官方宣称自带 Al 分析报告，可以得出多维度的统计信息。