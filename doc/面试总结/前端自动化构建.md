# 前端自动化构建工具

> 自动化构建在前端工程化中扮演者十分重要的角色，承载并解决开发过程中的重要内容。主要包含如下流程：**流程管理**、版本构建、**资源管理**、**组件化**、脚手架







## Gulp

### gulp 是什么？

`gulp` 它主要是用做文件合并、文件压缩、语法检查、监听文件变化的一个工具。

### 为什么选择 gulp?

因为它与其他工具对比，更容易使用，api更加简单，这对于我们的工作效率有着很大的一个提升。其优点包含以下4点：

1. 易于使用：通过代码优于配置的策略，gulp 让简单的任务简单，复杂的任务可管理。

2. 构建快速: 利用 Node.js 流的威力，你可以快速构建项目并减少频繁的 IO 操作。

3. 插件高质: gulp 严格的插件指南确保插件如你期望的那样简洁高质得工作。

4. 易于学习: 通过最少的 API，掌握 gulp 毫不费力，构建工作尽在掌握：如同一系列流管道。

### 为什么Gulp的效率高？

##### 任务化

gulp将所有的工作划分为不同的任务，所以gulp在处理事情时，首先要创建任务。

##### 基于流

这里的流就是数据流（I/O），也就是输入输出的数据流。它在执行构建的时候会申请自己的内存空间，从本地读取文件，将文件数据读取到申请的内存空间内进行处理，上面创建的所有任务都是在此内存空间内进行操作处理，比如说合并、压缩、编译css等。当所有的任务处理完后在以流的形式输出成本地文件。







## 前端架构

### SPA 

比如我们经常用的的Vue React 经过Webpack等构建工具的打包，输出dist文件，这种的前端页面路由是假路由，监听的是hashchange和popstate。然后将dist文件交给nginx去启动。这是最常见的、非常传统的一种项目架构。

###  MPA

这种是更古老的一种项目架构，比如说PHP+ASP或者JAVA+JSP，就是模板输出，将这整个也所有的内容全部返回。 不过好在有ajax的出现，避免了这种将大量数据内容一股脑的返回的情况，可返回只显示的内容，然后通过ajax去请求后序响应的数据。虽然这是非常古老的一种方式，但是从纯前端的角度来说，可以通过Node的koa加上模板引擎pug或者swig，这种框架的另一种名称叫做：SSR，`Server Side Render`。为什么这种架构有出现了呢？ 是因为首页性能。上面说到的SPA架构，最大的问题就是首页白屏的问题，比如一个VUE的项目，首页加载要经过`index.html` -> `vue.min.js/各种chunk.js/index.js` -> `ajax/fetch`请求 -> `DomDiff` 等流程才能完全显示出来，这个流程就会让页面的性能比较低，尤其是移动端。

### MPA + SPA

这里主要是真假路由的互用， 又叫**BFF架构**。主要是通过Node服务作为中间层，一方面进行接口转发和接口数据精简工作，另一方面就是控制前端路由，这样也避免了跨域的问题，还有一点就是可以独立上线，单独提供接口，然后也可避免java端异常，进行容错处理。因为Node做了中间层，而node和后端java的通信就不能用HTTP请求了，而是使用Unix domain socket rpc通道效率会更高。

### 同构

MPA+SPA的项目需要用到两种模板引擎（`swig、vue`），它们的工作一样都是吐出页面的html，所以这样用两套模板引擎的就有些冗余了，那么就可以使用到同构，就相当于抛弃了`swig`，直接使用`koa + vue/react` ，主要关注模板引擎的渲染性能即可。Vue或者React打包后的html的string或者js交给koa来渲染。

